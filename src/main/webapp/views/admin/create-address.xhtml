<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
		"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:p="http://primefaces.org/ui"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	  xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:pe="http://primefaces.org/ui/extensions">
<f:view contentType="text/html">
	<ui:composition template="../../szablony/ekranSzablonHoryzontalny.xhtml">
		<ui:define name="content">
			<p:growl id="messages" showDetail="true"/>
			<p:tabView>
				<p:tab title="#{i18n['add-block']}">
					<p:gmap id="gmap" center="51.76,19.46" zoom="16" type="HYBRID" style="width:80%;height:600px"
							model="#{addingAddressBean.emptyModel}" onPointClick="handlePointClick(event);"
							widgetVar="map"/>
					<h:form id="block">
						<h:inputHidden value="#{addingAddressBean.city}" requiredMessage="#{i18n['required-map']}"
									   required="true"/>
						<p:panelGrid columns="2">
							<p:outputLabel value="#{i18n['city']}"/>
							<p:outputLabel value="#{addingAddressBean.city}" id="city">
							</p:outputLabel>

							<p:outputLabel value="#{i18n['post-code']}"/>
							<p:outputLabel value="#{addingAddressBean.postCode}" id="postCode"/>

							<p:outputLabel value="#{i18n['street']}"/>
							<p:outputLabel value="#{addingAddressBean.street}" id="street"/>

							<p:outputLabel value="#{i18n['flat-number']}"/>
							<p:inputText value="#{addingAddressBean.flatNumber}" id="flat" required="true" maxlength="4"
										 requiredMessage="#{i18n['required-flat-number']}"/>

							<p:commandButton actionListener="#{addingAddressBean.addAddress}"
											 value="#{i18n['add-block']}" update=":messages"/>
						</p:panelGrid>
					</h:form>
					<h:form prependId="false" id="hidden">
						<h:inputHidden id="lat" value="#{addingAddressBean.lat}"/>
						<h:inputHidden id="lng" value="#{addingAddressBean.lng}"/>
						<p:commandLink id="hiddenButton" actionListener="#{addingAddressBean.geolocationPosition}"
									   style="display:none" update=":messages" resetValues="true"/>
					</h:form>
					<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
					<script type="text/javascript">
						var currentMarker = null;
						function handlePointClick(event) {
							if (null !== currentMarker) {
								currentMarker.setMap(null);
							}
							document.getElementById('lat').value = event.latLng.lat();
							document.getElementById('lng').value = event.latLng.lng();
							currentMarker = new google.maps.Marker({
								position: new google.maps.LatLng(event.latLng.lat(), event.latLng.lng())
							});
							PF('map').addOverlay(currentMarker);
							$('#hiddenButton').click();
						}
					</script>
				</p:tab>
				<p:tab title="#{i18n['addres-management']}">
					<p:dialog id="apartmentsDialog" header="#{i18n['apartments']}" widgetVar="apartmentsDialog"
							  showEffect="fade" hideEffect="fade" height="500px" width="400px"
							  appendTo="@(body)">
						<h:form id="apartments">
							<p:dataTable var="appartment" value="#{addingAddressBean.apartments}">
								<p:column headerText="#{i18n['apartment']}">
									<h:inputText value="#{appartment.apartmentNumber}" required="true"
												 requiredMessage="#{i18n['required-appartmnet-number']}"/>
								</p:column>

								<p:column headerText="#{i18n['roomers-count']}">
									<h:inputText value="#{appartment.roomersCount}" required="true"
												 requiredMessage="#{i18n['required-roomers-count']}">
										<pe:keyFilter mask="int"/>
									</h:inputText>
								</p:column>
							</p:dataTable>
							<p:commandButton value="#{i18n['add-apartment']}"
											 actionListener="#{addingAddressBean.addNewApartment}"
											 update=":messages"/>
						</h:form>
					</p:dialog>
				</p:tab>
				<p:tab title="#{i18n['user-to-local']}">

				</p:tab>
			</p:tabView>
		</ui:define>
	</ui:composition>
</f:view>
</html>
